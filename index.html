<script>
  function storeRedirect() {
    let platform = navigator?.userAgentData?.platform || navigator?.platform || 'unknown'
    const isMacLike = /(Mac|iPhone|iPod|iPad)/i.test(platform);
    if (isMacLike) {
      window.location.href =
        "https://apps.apple.com/ph/app/singlife-plan-protect/id1611353511";
    } else {
      window.location.href =
        "https://play.google.com/store/apps/details?id=ph.com.singlife.app";
    }
  }

  function appRedirect() {
    const params = new Proxy(new URLSearchParams(window.location.search), {
      get: (searchParams, prop) => searchParams.get(prop),
    });

    const { screen } = params;
    let deeplink = `singlifeph://${screen}?`;
    let keys = Object.keys(params);

    keys.forEach((key, i) => {
      if (key !== 'screen') {
        deeplink += `${key}=${params[key]}&`;
      }
    });

    if (deeplink.charAt(deeplink.length -1) === '&') {
      deeplink = deeplink.substring(0, deeplink.length - 1);
    }

    console.log(deeplink);

    // window.location.href = deeplink;
  }

  function runDeeplink() {
    var now = new Date().valueOf();
    setTimeout(function () {
      if (new Date().valueOf() - now > 100) return;
      storeRedirect();
    }, 50);
    appRedirect();
  }

  runDeeplink();
</script>
